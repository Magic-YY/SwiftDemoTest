%%{init: {"flowchart": {"htmlLabels": false, "curve": "basis"}, "theme": "base", "themeVariables": {"primaryColor": "#ffffff", "primaryTextColor": "#333333", "primaryBorderColor": "#333333", "lineColor": "#333333"}}}%%
flowchart TD
    %% 用户挽留流程 - 流式步骤
    Start([开始]) --> Step1[用户在付费页面]
    
    Step1 --> Trigger{触发挽留？}
    Trigger -->|点击关闭按钮| Step2[触发挽留流程]
    Trigger -->|IAP支付取消| Step2
    Trigger -->|正常支付| End1([流程结束 - 支付成功])
    
    Step2 --> Step3[显示转盘页面]
    Step3 --> Step4[页面初始化<br/>• 显示转盘图片<br/>• 底部按钮可点击<br/>• 无关闭按钮]
    
    Step4 --> Wait[等待用户操作...]
    Wait --> Step5[用户点击底部按钮]
    
    Step5 --> Step6[开始转盘动画]
    Step6 --> Step7[按钮状态变更<br/>• 底部按钮禁止交互<br/>• 转盘开始转动]
    
    Step7 --> Step8[转盘动画执行中...]
    Step8 --> Step9[动画结束判断]
    
    Step9 --> Step10[跳转挽留付费页]
    Step10 --> End2([流程结束 - 进入挽留页])
    
    %% 样式定义
    classDef startEnd fill:#e8f5e8,stroke:#4caf50,stroke-width:3px,text-align:center
    classDef normalStep fill:#e3f2fd,stroke:#2196f3,stroke-width:2px,text-align:center
    classDef triggerStep fill:#fff3e0,stroke:#ff9800,stroke-width:2px,text-align:center
    classDef actionStep fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px,text-align:center
    classDef waitStep fill:#ffebee,stroke:#f44336,stroke-width:2px,text-align:center
    
    class Start,End1,End2 startEnd
    class Step1,Step3,Step4,Step10 normalStep
    class Trigger,Step2 triggerStep
    class Step5,Step6,Step7,Step8,Step9 actionStep
    class Wait waitStep